<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ğŸ“¦ Batch ì‹¤í–‰</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 500px;
            margin: 50px auto;
            padding: 20px;
        }

        label {
            font-weight: bold;
        }

        input[type="date"],
        input[type="text"] {
            width: 100%;
            padding: 8px;
            margin-top: 4px;
            margin-bottom: 16px;
            box-sizing: border-box;
        }

        button {
            padding: 10px 16px;
            margin-right: 10px;
            font-size: 14px;
            cursor: pointer;
        }

        #buttons {
            margin-top: 20px;
        }
    </style>
</head>
<body>

<h2>ğŸ“¦ ë°°ì¹˜ ì‘ì—… ì‹¤í–‰</h2>

<form id="batchForm">
    <label for="joinedAfter">ê°€ì…ì¼ (joinedAfter):</label><br>
    <input type="date" id="joinedAfter" name="joinedAfter" required><br>

    <label for="outputFile">CSV ì €ì¥ ê²½ë¡œ (outputFile):</label><br>
    <input type="text" id="outputFile" name="outputFile" value="/Users/b.k.kang/Desktop/output_users.csv" required><br>

    <div id="buttons">
        <button type="submit">ğŸŸ¢ ì‹¤í–‰í•˜ê¸°</button>
        <button type="button" onclick="shutdownApp()">ğŸ›‘ ì¢…ë£Œ</button>
    </div>
</form>

<script>
    document.getElementById("batchForm").addEventListener("submit", function (e) {
        e.preventDefault();

        const joinedAfter = document.getElementById("joinedAfter").value;
        const outputFile = document.getElementById("outputFile").value;

        fetch("/batch/run", {
            method: "POST",
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: `joinedAfter=${encodeURIComponent(joinedAfter)}&outputFile=${encodeURIComponent(outputFile)}`
        })
            .then(res => res.text())
            .then(msg => alert(msg))
            .catch(err => alert("ì‹¤í–‰ ìš”ì²­ ì‹¤íŒ¨: " + err));
    });

    function shutdownApp() {
        fetch("/batch/shutdown", { method: "POST" })
            .then(res => res.text())
            .then(msg => alert(msg))
            .catch(err => alert("ì¢…ë£Œ ìš”ì²­ ì‹¤íŒ¨: " + err));
    }
</script>

</body>
</html>
